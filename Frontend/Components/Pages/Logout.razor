@page "/logout"

@rendermode InteractiveServer

@inject NavigationManager NavigationManager
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage

@using Frontend.Components.Layout

<div style="display:flex; flex-direction: column; align-items: center; width: 100%;">
    <h3>Logging out</h3>
</div>

<div class="spinner-container">
    <div class="spinner"></div>
</div>

@code {
    [Inject] public HttpClient? Http { get; set; }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Invoking function to delete the session
            if (Http != null)
            {
                Http.DefaultRequestHeaders.Remove("Authorization");
            }
            await sessionStorage.ClearAsync();
            MainLayout.jwtToken = string.Empty;
            MainLayout.userRole = string.Empty;
            StateHasChanged();

            NavigationManager.NavigateTo("/");
        }
    }
}
